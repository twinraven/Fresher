var App=angular.module("Fresht",["ngRoute"]);App.controller("compareCtrl",["$scope","$location","$q","moviesService","stateService",function(e,t,i,r,o){"use strict";var n=this,a=t.search();a&&a.movie1&&a.movie2&&(o.setAllLoadingState(),i.all([r.getMovieDataById(a.movie1),r.getMovieDataById(a.movie2)]).then(function(e){n.movies[0]=e[0],n.movies[1]=e[1],o.clearAllLoadingState()},function(e){console.log(e)})),n.getMovieAtPos=r.getMovieAtPos,n.movies=r.getMovies(),n.state=o.getState()}]),App.controller("headerCtrl",["moviesService","stateService",function(e,t){"use strict";this.reset=function(){e.clearMovies(),e.clearUrlParams(),t.setMoreState(!1),t.setSearchState(!1),t.clearAllLoadingState()}}]),App.controller("searchCtrl",["$scope","$timeout","moviesService","stateService",function(e,t,i,r){"use strict";var o=this;o.results=null,o.clear=function(){o.results=null,o.title="",r.clearAllLoadingState()},o.start=function(){if(o.title){var e=i.search(o.title);e.success(function(e){o.results=e.movies}).error(function(){console.log("error")})}},o.use=function(e){i.save(o.results[e],o.state.searchActiveId)&&o.close()},o.close=function(){r.setSearchState(!1),o.clear()},o.state=r.getState()}]),App.directive("addMovie",["stateService",function(e){"use strict";return{restrict:"E",replace:"true",scope:{movie:"=",id:"@"},bindToController:!0,templateUrl:"partials/add-movie.html",link:function(t,i,r){t.add=function(){e.setSearchState(!0,t.id),e.setLoadingState(t.id,!0)}}}}]),App.directive("hasFocusWhen",[function(){"use strict";return{restrict:"A",scope:{when:"=hasFocusWhen"},link:function(e,t,i){e.$watch("when",function(e,i){e!==!0||i||t[0].focus()})}}}]),App.directive("movieFull",["moviesService","stateService",function(e,t){"use strict";return{restrict:"E",replace:"true",scope:!0,templateUrl:"partials/movie-full.html",link:function(i,r,o){i.movie={},i.close=function(){t.setMoreState(!1)},i.$watch(t.getState,function(t,r){t&&t.activeMovie&&(i.movie=e.getCachedMovieDataById(t.activeMovie))},!0)}}}]),App.directive("movieTile",["moviesService","stateService",function(e,t){"use strict";return{restrict:"E",replace:"true",scope:{movie:"="},templateUrl:"partials/movie-tile.html",link:function(i,r,o){i.more=function(){t.setMoreState(!0),t.setActiveMovie(i.movie.id)},i.remove=function(t){e.remove(t),e.clearUrlParams()}}}}]),App.filter("prettyTime",function(){"use strict";return function(e){if(void 0===e||0===e.length)return e;e=Number(e);var t=Math.floor(e/60),i=60*t,r=Math.round(e-i);return t+" hr. "+r+" min."}}),App.config(["$routeProvider",function(e){"use strict";e.when("/",{templateUrl:"partials/main.html",reloadOnSearch:!1}),e.otherwise({redirectTo:"/"})}]),App.service("moviesService",["$http","$location",function(e,t){"use strict";var i=[],r={},o="http://api.rottentomatoes.com/api/public/v1.0/movies/%ID%.json?apikey=%APIKEY%&callback=JSONP_CALLBACK";return r.getMovies=function(){return i},r.getMovieAtPos=function(e){return i[0]&&i[0].pos==e?i[0]:i[1]&&i[1].pos==e?i[1]:null},r.clearMovies=function(){i.length=0},r.isMovieCached=function(e){var t=_.filter(i,function(t){return t.id===e});return t.length},r.save=function(e,t){var o;return r.isMovieCached(e.id)?(alert("this movie is already in your comparison.\nPlease choose another"),!1):(i.length<2?(null!==t&&void 0!==t&&(o=t),e.pos=o,i[i.length]=e,2===i.length&&r.addComparisonToUrl()):alert("you already have 2 movies. Please remove 1 first"),!0)},r.addComparisonToUrl=function(){t.search({movie1:i[0].id,movie2:i[1].id})},r.clearUrlParams=function(){t.search({})},r.remove=function(e){var t=-1;_.find(i,function(i,r){i.id===e&&(t=r)}),-1!==t&&i.splice(t,1)},r.getSearchUrl=function(e){return"json/search.json"},r.getMovieUrl=function(e){return o.replace(/%ID%/,e).replace(/%APIKEY%/,APIKEY)},r.search=function(t){var i=r.getSearchUrl(t);return e.get(i)},r.getCachedMovieDataById=function(e){return _.find(i,function(t){return t.id===e})},r.getMovieDataById=function(t){var i=r.getMovieUrl(t);return e.jsonp(i)},r}]),App.service("stateService",[function(){"use strict";var e={},t={searchActive:!1,searchActiveId:null,moreActive:!1,activeMovie:null,loading:[!1,!1]};return e.getState=function(){return t},e.setSearchState=function(e,i){t.searchActive=e,t.searchActiveId=i||null},e.setMoreState=function(e){t.moreActive=e},e.setActiveMovie=function(e){t.activeMovie=e},e.setLoadingState=function(e,i){t.loading[e]=i},e.setAllLoadingState=function(){e.setLoadingState(0,!0),e.setLoadingState(1,!0)},e.clearAllLoadingState=function(){e.setLoadingState(0,!1),e.setLoadingState(1,!1)},e}]);